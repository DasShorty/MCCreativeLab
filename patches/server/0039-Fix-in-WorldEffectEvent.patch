From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: derverdox <mail.ysp@web.de>
Date: Fri, 26 Jan 2024 15:29:48 +0100
Subject: [PATCH] Fix in WorldEffectEvent


diff --git a/src/main/java/de/verdox/mccreativelab/event/EventToPacketFactory.java b/src/main/java/de/verdox/mccreativelab/event/EventToPacketFactory.java
index 54d523c62380a43c7b59d16526d273937db8b735..36a7586a5e25e9a59f3f1df2adabed34bba95ab1 100644
--- a/src/main/java/de/verdox/mccreativelab/event/EventToPacketFactory.java
+++ b/src/main/java/de/verdox/mccreativelab/event/EventToPacketFactory.java
@@ -18,6 +18,7 @@ import net.minecraft.world.level.GameRules;
 import org.bukkit.Effect;
 import org.bukkit.Location;
 import org.bukkit.NamespacedKey;
+import org.bukkit.craftbukkit.CraftEffect;
 import org.bukkit.craftbukkit.CraftWorld;
 import org.bukkit.craftbukkit.entity.CraftPlayer;
 import org.bukkit.craftbukkit.util.CraftNamespacedKey;
@@ -74,10 +75,15 @@ public class EventToPacketFactory {
         if (!event.callEvent()) return;
         ServerLevel serverLevel = ((CraftWorld) event.getWorld()).getHandle();
 
+        int data;
+        if (event.getData() instanceof Integer integer)
+            data = integer;
+        else
+            data = CraftEffect.getDataValue(event.getEffect(), event.getData());
+
         ClientboundLevelEventPacket clientboundLevelEventPacket = new ClientboundLevelEventPacket(event.getEffect()
                                                                                                        .getId(), new BlockPos(event
-            .getSoundLocation().getBlockX(), event.getSoundLocation().getBlockY(), event.getSoundLocation()
-                                                                                        .getBlockZ()), event.getData(), event.isGlobal());
+            .getSoundLocation().getBlockX(), event.getSoundLocation().getBlockY(), event.getSoundLocation().getBlockZ()), data, event.isGlobal());
 
         if (event.isGlobal())
             serverLevel.getServer().getPlayerList().broadcastAll(clientboundLevelEventPacket);
